locate : 文件搜索,在文件资料库中查找文件
updatedb : 更新locate的资料库

which : 搜索命令所在目录及别名信息
whereis : 搜索命令所在目录及帮助文档路径

grep : 在文件中搜寻字串匹配的行并输出
    语法： grep -iv [指定字符串][文件]
    -i 不区分大小写
    -v 排除指定字符串



man : manual,获得帮助信息
    语法： man [命令名称]
    man 1 命令的帮助
    man 5 配置文件的帮助

whatis : 查看最简短的命令简介

apropos : 查看一个配置文件的信息

command --help : 查看帮助
info command : 查看帮助
help : 查看shell内置命令的帮助信息

useradd 用户名 : 添加新用户

who : 查看用户登录信息

组成部分 | 说明
--------|------
第一部分 | 用户名
第二部分 | 登录方式tty 本地登录，pts 远程登录
第三部分 | 登录时间
第四部分 | ip地址

w : 查看登录的用户，以及当前系统的资源使用情况和各用户的资源使用情况


##压缩
   
###gzip
gzip 文件名 : 压缩文件为.gz 

属性 | 说明
-----|------
-d | 解压缩

gunzip 文件名 : 解压缩 .gz 

###tar打包目录
语法：
tar 选项[-zcf][压缩后的文件名] [目录]

属性 | 说明
-----|-----
-c | 打包
-v | 显示详细信息
-f | 指定文件名
-z | 打包同时压缩
-j | 压缩为bzip2格式(.bz2)
-x | 解压缩

```
tar -zcf j.tar j
```     
###zip压缩文件或目录
语法: zip 选项[-r] [压缩后的文件名] [文件或目录]


属性 | 说明
-----|-----
-r | 压缩目录

压缩后的文件格式 .zip
###unzip解压.zip的压缩文件
    
语法： unzip [压缩文件]

###bzip2压缩文件
 
语法：bzip2 选项[-k] [文件]

属性 | 说明
-----|-----
-k | 产生压缩文件后保留原文件
压缩后文件格式： .bz2

###bunzip2解压缩
语法：bunzip2 选项[-k] [压缩文件]
    



#网络命令

write <用户名> :给用户发信息，以Ctrl+D保存结束

wall [message] : write all,给所有在线用户发信息

mail [用户名] : 查看发送电子邮件 

last : 列出目前与过去登入系统的用户信息

lastlog : 用户最后一次登录log

属性 | 说明
-----|-----
-u | [uid] 只查看用户uid的日志

traceroute [address] : 显示数据包到主机间的路径

netstat [选项] : 显示网络相关信息

属性 | 说明
-----|-----
-t | tcp协议
-u | udp协议
-l | 监听
-r | 路由
-n | 显示ip地址和端口号

```
例子：
$   netstat -tlun 查看本机监听的端口
$   netstat -an   查看本机所有的网络连接
$   netstat -rn   查看本机路有表
```

setup : 配置网络（root），一个redhat开发的管理集合

mount [-t 文件系统] : 设备文件名挂载点
```
    mount -t iso9660 /dev/sr0 /mnt/cdrom/
```

#关机

shutdown [选项] [时间] : 关机

属性 | 说明
-----|-----
-h | (now) 关机
-r | (now) 重启
-c | 取消前一个关机命令
#系统运行级别
init 系统运行级别 ： 更改系统运行级别

级别 | 说明
-----|-----
0 | 关机
1 | 单用户
2 | 不完全多用户，不含NFS服务
3 | 完全多用户
4 | 未分配
5 | 图形界面
6 | 重启

runlevel : 查看系统运行级别


#软件包管理

###软件包分类
* 源码包
* 脚本安装包
* 二进制包(RPM包、系统默认包)

###RPM
模块查询网址： www.rpmfind.net
包全名：操作的包是没有安装的软件时，使用包全名。而且要注意路径
包名：操作已经安装的软件包时，使用包名。是搜索/var/lib/rpm/中的数据库

####rpm安装：
 rpm -ivh 包全名
 
属性 | 说明
-----|-----
-i(install) | 安装
-v(verbose) | 显示详细信息
-h(hash) | 显示进度
-U(upgrade) | 升级
-e(erase) | 卸载
--nodeps | 不检测依赖性

####rpm查询：
  rpm -q 包名 查询是否安装
  rpm -qa 查询所有已安装（-a all）
  
属性 | 说明
-----|-----
-i | 查询软件信息（infomation）
-p | 查询未安装包信息（package）
-l | 列表（list）
-f | 查询系统文件属于哪个软件包（file）
-R | 查询软件包的依赖性（requires）

####rpm包校验：
  rpm -V 已安装的包名
      －V 校验指定rpm包中的文件（verify）
      
验证内容中的8个信息的具体内容如下：

* S 文件大小是否改变
* M 文件类型或文件权限是否被改变
* 5 文件MD5校验和是否改变（可以看成文件内容是否改变）
* D 设备中，从代码是否改变
* L 文件路径是否改变
* U 文件的所有者是否改变
* G 文件的所属组是否改变
* T 文件的修改时间是否改变

文件类型如下：

* s 配置文件（config file）
* d 普通文档（documentation）
* g “鬼”文件（ghost file），很少见，就是改文件不应该被这个rpm包包含
* l 授权文件（license file）
* r 描述文件（read me）

####rpm包中文件提取
  rpm2cpio 包全名 | cpio -idv .文件绝对路径
  rpm2cpio 将rpm包转换为cpio格式的命令
  cpio 是一个标准工具，它用于创建软件档案文件和从档案文件中提取文件





###rpm包管理－yum在线管理：
  网络yum源：
  vim /etc/yum.repos.d/CentOS-Base.repo
  
字段 | 说明
-----|-----
[base] | 容器名称，一定要放在[]中
name   | 容器说明，可以自己随便写
mirrorlist | 镜像站点，这个可以注释掉
baseurl | 我们的yum源服务器地址。默认是CentOS官方的yum源服务器，是可以使用的，如果觉得慢可以改成你喜欢的yum源地址
enabled | 此容器是否生效，如果不写或写成enable=1都是生效，写成enable=0就是不生效
gpgcheck | 如果是1是指rpm的数字证书生效，如果是0则不生效
gpgkey | 数字证书的公钥文件保存位置，不用修改


###yum命令：
yum [-y] 自动回答yes

命令 | 说明
-----|-----
list | 查询所有可用软件包列表
search 关键字 | 搜索服务器上所有和关键字相关的包
install 包名 | 安装
update [包名] | 升级 如果不加包名会升级所有的包（包括系统内核）
remove 包名 | 卸载(不建议使用）

###软件组管理命令
grouplist : 列出所有可用的软件组列表

groupinstall 软件组名 ：安装指定软件组，组名可以由grouplist查询出来

groupremove 软件组名 ： 卸载指定软件组


###光盘yum源搭建：
 1、挂载光盘
```
$ mount /dev/cdrom /mnt/cdrom/ 
```
 2、让网络yum源文件失效
 ```
mv CentOS-Base.repo CentOS-Base.repo.bak
 ```
 3、修改光盘yum源文件
```
vim CentOS-Media.repo
    baseurl=file:///mnt/cdrom
    enabled=1
```
           
###源码包
源码包与rpm包的区别

rpm 包默认安装路径

路径 | 说明
-----|-----
/etc/          | 配置文件安装目录
/usr/bin/      | 可执行的命令安装目录
/usr/lib/      | 程序所使用的函数库保存位置
/usr/share/doc/| 基本软件使用手册保存位置
/usr/share/man/| 帮助文件保存位置

源码包安装位置
安装在指定位置当中，一般是
/usr/local/软件名/


安装位置不同带来的影响
rpm包安装的服务可以使用系统服务管理命令（service）来管理，例如rpm包安装的apache的启动方法是：
```
$ /etc/rc.d/init.d/httpd start
$ service httpd start (service 命令是redhat专有命令，其它linux不一定有)
```
二源码包安装的服务则不能被服务管理命令管理，因为没有安装到默认路径中。所以只能用绝对路径进行服务的管理，如：
```
/usr/local/apache/bin/apachectl start
```

###安装源码包
准备

1. 安装C语言编译器(gcc)
2. 下载源码包

注意

* 源代码保存位置：/usr/local/src/
* 软件安装位置：/usr/local/

如何确定安装过程报错：

*  安装过程停止
*  并出现error、warning或no的提示

3、 解压缩安装包，进入源码包目录
4、./configure软件配置于检查
  定义需要的功能选项
  检测系统环境是否符合安装要求。
  把定义好的功能选项与检测系统环境的信息都写入Makefile文件，用于后续的编译。
5、make
  make clean : 清空make的临时文件（如果放弃make install)
6、make install

###源码包的卸载
直接删除源码包的安装目录

du -sh 查看占用硬盘大小


#文件系统管理
###分区
* 主分区： 总共最多只能分四个
* 扩展分区： 只能有一个，也算做主分区的一种，也就是主分区加扩展分区最多有四个。但是扩展分区不能存储数据和格式化，必须再划分逻辑分区才能使用。
* 逻辑分区： 逻辑分区在扩展分区中划分，如果是IDE硬盘，Linux最多支持59个逻辑分区，如果是SCSI硬盘Linux最多支持11个逻辑分区。

分区的设备文件名|文件
---|---
主分区1 | /dev/sda1
主分区2 | /dev/sda2
主分区3 | /dev/sda3
扩展分区 |/dev/sda4
逻辑分区1|/dev/sda1
逻辑分区2|/dev/sda2
逻辑分区3|/dev/sda3

就算主分区+扩展分区一共也不够4个，逻辑分区依然从sda5开始，1-4始终会留给主分区／扩展分区使用

###文件系统
* ext2: 是ext文件系统的升级版本，Red Hat Linux7.2版本以前的系统默认都是ext2文件系统。1993年发布，最大支持16TB的分区和最大2TB的文件。
* ext3: 是ext2文件系统的升级版本，最大的区别就是带日志功能，以在系统突然停止时提高文件系统的可靠性。支持最大16TB的分区和最大2TB的文件
* ext4: 它是ext3文件系统的升级版。ext4在性能、伸缩性和可靠性方面进行了大量改进。EXT5的变化可以说是翻天覆地的，比如向下兼容EXT3、最大1EB文件系统和16TB文件、无限数目子目录、Extents连续数据块概念、多块分配、延迟分配、持久预分配、快速FSCK、日志教研、无日志模式、在线碎片整理、inode增强、默认启用barrier等。是CentOS6.3的默认文件系统。(1EB=1024PB=1024 * 1024TB)

##文件系统常用命令
####统计文件系统大小 df
df [选项][挂载点]

选项 | 说明
-----|-----
-a |显示所有的文件系统信息，包括特殊文件系统，如/proc、/sysfs
-h |使用习惯单位显示容量，如KB，MB等
-T |显示文件系统类型
-m |以MB为单位显示容量
-k |以KB为单位显示容量。默认就是以KB为单位

####统计文件系统大小
du [选项][目录或文件名]

选项 | 说明
-----|-----
-a | 显示每个字文件的磁盘占用量。默认只统计子目录的磁盘占用量
-s | 统计总站用量，而不列出子目录和子文件的占用量
-h | 使用习惯单位显示容量，如KB，MB等

####du命令和df命令的区别

* df命令是从文件系统考虑的，不光要考虑文件占用的空间，还要统计被命令和或程序占用的空间（最常见的就是文件已经删除，但是程序并没有释放空间）
* du命令是面向文件的，只会计算文件或目录占用的空间

####文件系统修复命令fsck
fsck [选项] 分区设备文件名

选项 | 说明
-----|-----
-a | 不用显示用户提示，自动修复文件系统
-y | 自动修复。与-a作用一致，不过有些文件系统只支持-y

####显示磁盘状态命令dumpe2fs
dumpe2fs 分区设备文件名


###挂载命令
mount [-l]
查询系统中已经挂载的设备，-l会显示卷标名称

mount -a 
依据配置文件 /etc/fstab 的内容，自动挂载

挂载命令格式
mount [-t 文件系统] [-L 卷标名] [-o 特殊选项] 设备文件名 挂载点

选项 | 说明
-----|-----
-t | 文件系统：加入文件系统类型来指定挂载的类型，可以ext3、ext4、iso9660等文件系统
-L | 卷标名： 挂载指定卷标的分区，而不是安装设备文件名挂载
-o | 特殊选项： 可以指定挂载的额外选项

参数  | 说明
-----|---------
atime/noatime| 更新访问时间／不更新访问时间。访问分区文件时，是否更新文件的访问时间，默认更新
async/sync | 异步／同步，默认为异步
auto/noauto | 自动／手动，mount -a 命令执行时，是否会自动安装/etc/fstab文件内容挂载，默认为自动
defaults | 定义默认值，相当于rw,suid,dev,exec,auto,nouser,async这七个选项
exec/noexec| 执行／不执行，设定是否允许在文件系统中执行可执行文件，默认时exec允许
remount | 重新挂载已经挂载的文件系统，一般用于指定修改特殊权限
rw/ro | 读写／只读，文件系统挂载时，是否具有读写权限，默认时rw
suid/nosuid | 具有／不具有SUID权限，设定文件系统是否具有SUID和SGID的权限，默认是具有
user/nouser | 允许／不允许普通用户挂载，设定文件系统是否允许普通用户挂载，默认是不允许，只有root可以挂载分区
usrquota | 写入代表文件系统支持用户磁盘配额，默认不支持
grpquota | 写入代表文件系统支持组磁盘配额，默认不支持

#用户和用户组管理


##用户配置文件
在linux中主要是通过用户配置文件来查看和修改用户信息

### 用户信息文件 /etc/passwd  
```
$ man 5 passwd查看帮助
```
* 第1字段： 用户名称
* 第2字段： 密码标志 如果x，则密码会存储在/etc/shadow中，如果不写的话，说明这个用户不允许外部访问
* 第3字段： Uid
   * 0: 超级用户
   * 1-499： 系统用户（伪用户，linux系统用户，如果删除后有可能会造成系统崩溃）
   * 500-65535: 普通用户
   * 如果uid相同，系统内核则会认为它们是同一个用户，比如把某一个用户的uid改为0，内核则认为此用户就是root。
* 第4字段： GID（用户初始组ID）
   * 初始组：就是指用户一登录就立刻拥有这个用户组的相关权限，每个用户的初始组只能有一个，一般就是和这个用户的用户名相同的组名作为这个用户的初始组（不建议更改）。
   * 附加组：指用户可以加入多个其他的用户组，并拥有这些组的权限，附加组可以有多个。
* 第5字段： 用户说明
* 第6字段： 家目录
   * 普通用户： /home/用户名
   * 超级用户: /root
* 第7字段：登录之后的Shell(linux命令解释器，在/etc/passwd当中，除了标准Shell是/bin/bash，还有/sbin/nologin等)


### 影子文件 /etc/shadow

* 第1字段： 用户名
* 第2字段： 加密密码
  *  加密算法升级为SHA512散列加密算法
  *  如果密码位是"!!"或" * "代表没有密码，不能登录(如果我们手动更改用户密码前为!则会造成此用户无法登录)
* 第3字段： 密码最后一次修改日期
  * 使用1970年1月1日作为标准时间，每过一天时间戳加1.
* 第4字段： 两次修改密码间隔（和第三个字段相比）
* 第5字段： 时间有效期（和第3字段相比）
* 第6字段： 密码修改到期前的警告天数（和第5字段相比）
* 第7字段： 密码过期后宽限天数（和第5字段相比）
  * 0／不写: 代表密码过期后立即失效
  * -1: 则代表密码永远不会失效。
* 第8字段： 账号失效时间（时间戳表示）
* 第9字段： 保留

时间戳换算日期： data -d '1970-01-01 16076 days'
### 组信息文件/etc/group

* 第1字段： 组名
* 第2字段： 组密码标志
* 第3字段： GID 
* 第4字段： 组中附加用户

###组密码文件/etc/gshadow

* 第1字段： 组名
* 第2字段： 组密码标志
* 第3字段： 组管理员用户名
* 第4字段： 组中附加用户

##用户管理相关文件
1. 用户的家目录
   1. 普通用户： /home/用户名／，所有者和所属组都是此用户，权限700
   2. 超级用户： /root/,所有者和所属组都是root用户，权限是550
2. 用户的邮箱
  1. /var/spool/mail/用户名／
3. 用户模版目录
  1. /etc/skel

##用户的管理命令
###用户添加命令（只添加用户，不设置密码是无法登录的） 
useradd [选项] 用户名

选项 | 说明
-----|-----
-u | UID： 手工指定用户的UID号
-d | 家目录： 手工指定用户的家目录
-c | 用户说明： 手工指定用户的说明
-g | 组名： 手工指定用户的初始组
-G | 组名： 指定用户的附加组
-s | shell： 手工指定用户的登录shell。默认是/bin/bash
    
/etc/default/useradd 用户默认值文件
GROUP=100 用户默认组
HOME=/home 用户家目录
INACTIVE=-1 密码过期宽限天数（shadow文件7字段）
EXPIRE= 密码失效时间（8）
SHELL=/bin/bash 默认shell
SKEL=/etc/skel 模版目录
CREATE_MAIL_SPOOL=yes 是否建立邮箱

/etc/login.defs 用户默认值文件
PASS_MAX_DAYS 99999 密码有效期（5）
PASS_MIN_DAYS 0 密码修改间隔（4）
PASS_MIN_LEN 5 密码最小5位（PAM）
PASS_WARN_AGE 7 密码到期警告（6）
UID_MIN 500 最小和最大UID范围
GID_MAX 60000
ENCRYPT_METHOD SHA512 加密模式

###修改用户密码

passwd [选项] [用户名]

选项 | 说明
-----|-----
-S | 查询用户密码的密码状态（仅root用户可用）
-l | 暂时锁定用户（仅root用户可用）
-u | 解锁用户（仅root用户可用）
--stdin | 可以通过管道符输出的数据作为用户的密码(echo '123'|passwd --stdin lamp)

###修改用户信息
usermod  [选项] 用户名

选项 | 说明
-----|-----
-u | UID： 手工指定用户的UID号
-d | 家目录： 手工指定用户的家目录
-c | 用户说明： 手工指定用户的说明
-g | 组名： 手工指定用户的初始组
-G | 组名： 指定用户的附加组
-s | shell： 手工指定用户的登录shell。默认是/bin/bash
-L | 暂时锁定用户（仅root用户可用）
-U | 解锁用户（仅root用户可用）


###修改用户密码状态
chare [选项] 用户名

选项 | 说明
-----|-----
-l | 列出用户的详细密码状态
-d 日期 | 修改密码最后一次更改日期（shadow3字段）
-m 天数 | 两次密码修改间隔（4字段）
-M 天数 | 密码有效期（5字段）
-W 天数 | 密码过期前警告天数（6字段）
-I 天数 | 密码过期后宽限天数（7字段）
-E 日期 | 账号实效时间（8字段）

最常用的命令： 
```
chage -d 0 用户名
把密码修改日期归0了（shadow第3字段），这样用户一登录就要修改密码
```
### 删除用户
userdel [-r] 用户名
-r 删除用户的同时删除用户家目录

### 查看用户id，组id
id 用户名

### 用户身份切换

su 用户名

选项 | 说明
-----|-----
- | 选项只使用"-" 代表连带用户的环境变量一起切换
-c 命令 | 仅执行一次命令，而不切换用户身份

### 查看用户环境变量
env


##用户组管理命令

### 添加用户组
groupadd [选项] 组名
-g GID： 指定组ID

### 修改用户组
groupmod [选项] 组名

选项 | 说明
-----|-----
-g GID | 修改组ID
-n 新组名 | 修改组名

### 删除用户组
groupdel 组名

### 把用户添加入组或从组中删除
gpasswd 选项 组名

选项 | 说明
-----|-----
-a 用户名 | 把用户加入组
-d 用户名 | 把用户从组中删除


#权限管理

##ACL权限

临时开启分区ACL权限
```
mount -o remont,acl /
重新挂载根分区，并挂载加入acl权限
```

永久开启分区ACL权限(修改自动挂载文件，重启系统／重新挂载根分区)
```
vim /etc/fatab 在defaults后面添加 ,acl
mount -o remount /  重新挂载文件系统或重启动系统，使修改生效
```

查看分区ACL权限是否开启
```
dumpe2fs -h /dev/sda3
dumpe2fs命令是查询指定分区详细文件系统信息的命令
    -h 仅显示超级块中信息，而不显示磁盘块组的详细信息
```

查看ACL命令
getfacle 文件名

设定ACL权限
setfacl 选项 文件名

选项 | 说明
-----|-----
-m | 设定ACL权限
-x | 删除指定的ACL权限
-b | 删除所有ACL权限
-d | 设定默认ACL权限
-k | 删除默认ACL权限
-R | 递归设定ACL权限

例如：
```
设置project目录针对用户st的ACL权限为rx,使用"u:用户名:权限"格式
$ setfacl -m u:st:rx project/

为组tgroup2分配ACL权限。使用"g:组名:权限"格式
$ setfacl -m g:tgroup2:rwx project/
```

3 最大有效权限与删除ACL权限
    最大有效权限mask
    mask是用来指定最大有效权限的。如果我给用户赋予ACL权限，是需要和mask的权限"相与"才能得到用户的真正权限(不影响所有用户，影响acl用户／用户组，以及所属用户组)
    setfacl -m m:rx 文件名
    设定mask权限为r-x。使用"m:权限"格式

    删除ACL权限
    删除指定用户／组的ACL权限
    setfacl -x u:用户名 文件名
    setfacl -x g:组名 文件名

    删除文件的所有ACL权限
    setfacl -b 文件名

4 默认ACL权限和递归ACL权限
    递归ACL权限：递归是父目录在设定ACL权限时，所有的字文件和子目录也会拥有相同的ACL权限。
    setfacl -m u:用户名:权限 -R 目录名

    默认ACL权限：如果给父目录设定了默认ACL权限，那么父目录中所有新建的子文件都会继承父目录的ACL权限。
    setfacl -m d:u:用户名:权限 目录名

##文件特殊权限
1 SetUID（危险）
    只有可以执行二进制程序才能设定SUID权限
    命令执行者要对该程序拥有x（执行）权限
    命令执行者在执行该程序时获得该程序文件属主的身份
    SetUID权限只在该程序执行过程中有效，也就是说身份改变只在程序执行过程中有效
    例如：
    passwd命令拥有SetUID权限，所以普通用户可以修改自己的密码
    
    设定SetUID的方法
    4代表SUID
    chmod 4755 文件名
    chmod u+s 文件名
2 SetGID
    可以给目录／文件设定，2代表SGID
    如果给目录设置SetGID，则在此目录中新建文件，其所属组为目录所属组。
    chmod 2755 文件名
    chmod g+s 文件名
3 Sticky BIT
    1代表SBIT
    SBIT粘着位作用：
        粘着位目前只对目录有效
        普通用户对该目录拥有w和x权限，即普通用户可以在此目录拥有写入权限
        如果没有粘着位，因为普通用户拥有w权限，所以可以删除此目录下所有文件，包括其他用户建立的文件。一旦赋予粘着位，除了root可以删除所有文件，普通用户就算拥有w权限，也只能删除自己建立的文件，但不能删除其他用户建立的文件。
    chmod 1755 目录名
    chmod o+t 目录名


##文件系统属性chattr权限
    设置命令格式：
    chattr [+-=][选项] 文件或目录名
        i: 如果对文件设置i属性，那么不允许对文件进行删除、更名，也不能添加和修改数据；如果对目录设置i属性，那么只能修改目录下文件的数据，但不允许建立和删除文件。
        a: 如果对文件设置a属性，那么只能在文件中增加数据，但是不能删除也不能修改数据；如果对目录设置a属性，那么只允许在目录中建立和修改文件，但是不允许删除。

    查看文件系统属性
    lsattr 选项 文件名
    -a 显示所有文件和目录
    -d 若目标是目录，仅列出目录本身的属性，而不是子文件的



##系统命令sudo权限
root把本来只能超级用户执行的命令赋予普通用户执行。
sudo的操作对象是系统命令
    #visudo
    实际上修改/etc/sudoers文件

    root ALL=(ALL) ALL
    用户名 被管理主机的地址=（可使用的身份） 授权命令（绝对路径）

    %wheel ALL=(ALL) ALL
    组名 被管理主机的地址=（可使用的身份） 授权命令（绝对路径）
    
    sudo -l :显示用户可以sudo使用的命令
    (root) /sbin/shutdown -r now
    
    设置bill用户可以重启服务器
    bill  ALL=/sbin/shutdown -r now

    设置bill用户可以使用sudo vim
    bill  192.168.147.131=/usr/bin/vim


# 下载文件

wget url: 下载url所指向的资源

curl -o 文件名 url:  将url资源下载到文件中

# 服务的简介和分类
linux服务
  RPM包默认安装的服务
    独立的服务
    基于xinetd服务
  源码包安装的服务

服务启动：就是在当前系统中让服务运行，并提供功能。
服务自启动：自启动是指让服务在系统开机或重启之后，随着系统的启动而自动启动服务。

###查询已安装的服务
RPM包安装的服务
chkconfig --list
查看服务自启动状态，可以看到所有RPM包安装的服务

源码包安装的服务
查看服务安装位置，一般是/usr/local/下

##RPM包安装的服务的管理方法

###独立服务的管理
/etc/init.d/  | /etc/rc.d/init.d/ :    启动脚本位置
/etc/sysconfig/ : 初始化环境配置文件位置
/etc/ : 配置文件位置
/etc/xinetd.conf : xinetd配置文件
/etc/xinetd.d : 基于xinetd服务的启动脚本
/var/lib/ : 服务产生的数据放在这里
/var/log/ : 日志

独立服务的启动
/etc/init.d/独立服务名  start|stop|status|restart|
service 独立服务名 start|stop|restart|status| (\*红帽linux专有)

独立服务的自启动
chkconfig [--level 运行级别] [独立服务名] [on|off]
修改/etc/rc.d/rc.local文件
使用ntsysv命令管理自启动(\*红帽linux专有)


## 源码包安装服务的管理

启动
使用绝对路径，调用启动脚本来启动。不同源码包的启动脚本不同。可以查看源码包的安装说明，查看启动脚本的方法。
/usr/local/apache/bin/apachectl start|stop

自启动
在/etc/rc.d/rc.local加入
/usr/local/apache/bin/apachectl start

让源码包服务被服务管理命令识别
ln -s /usr/local/apache/bin/apachectl /etc/init.d/apache

让源码包的apache服务能被chkconfig与ntsysv命令管理自启动
vim /etc/init.d apache
\#chkconfig: 35 86 76
\#指定httpd脚本可以被chkconfig命令管理。格式是：chkconfig: 运行级别 启动顺序 关闭顺序
\#desciption
\#注释




# 进程查看
进程是正在执行的一个程序或命令，每一个进程都是一个运行实体，都有自己的地址空间，并占用一定的系统资源。

## 进程管理的作用
1. 判断服务器健康状态
top [选项]
选项：
-d 秒数 : 指定top命令每隔几秒更新。默认是3秒
在top命令的交互模式当中可以执行的命令：
?或h : 显示交互模式的帮助
P : 以CPU使用率排序，默认就是此项
M : 以内存的使用率排序
N : 以PID排序
q : 退出top

输出信息讲解：
第一行信息为任务队列信息
12:26:46 : 系统当前时间
up 1 day, 13:32 : 系统的运行时间，本机已经运行了1天13小时32分钟
2 users : 当前登录了两个用户
load average : 0.00, 0.01, 0.05 : 系统在之前1分钟，五分钟，15分钟的平均负载。一般以为小于1时，负载较小。如果大于1，系统已经超出负荷。

第二行进程信息
Tasks: 95 total : 系统中的进程总数
1 running : 正在运行的进程数
94 sleeping : 睡眠的进程
0 stopped : 正在停止的进程
0 zombie : 僵尸进程。如果不是0，需要手工检查僵尸进程

第三行CPU信息
Cpu(s): 0.1% us : 用户模式占用的CPU百分比
0.1%sy : 系统模式占用的CPU百分比
0.0%ni : 改变过优先级的用户进程占用的CPU百分比
99.7% id : 空闲CPU的百分比
0.1 %wa : 等待输入/输出的进程占用CPU百分比
0.0%hi : 硬中断请求服务占用的CPU百分比
0.0%si : 软中断请求服务占用的CPU百分比
0.0%st : st(Steal time)虚拟时间百分比。就是当有虚拟机时，虚拟CPU等待实际CPU的时间百分比。

第四行为物理内存信息
Mem: 998636 : 物理内存的总量，单位KB
554584 free : 空闲的物理内存数量
158000 used : 已经使用的物理内存数量
287068 buff/cache : 作为缓冲的内存数量

第五行为交换分区(swap)信息
Swap: 2097148 total : 交换分区（虚拟内存）的总大小
2097148 free : 空闲交换分区的大小
0 used : 已经使用的交换分区的大小
658760 cached : 作为缓存的交互分区的大小



2. 查看系统的所有进程

ps
ps aux #查看系统中所有进程，使用BSD操作系统格式
a 查看所有前台进程
x 查看所有后台进程
u 查看进程是由那个用户产生的

ps -le #查看系统中所有进程，使用linux标准命令格式
l 显示更加详细信息
e 显示所有进程

输出字段介绍：
USER : 该进程是由哪个用户产生的
PID : 进程的ID号
%CPU : 该进程占用CPU资源的百分比，占用越高，进程越耗费资源
%MEM : 该进程占用物理内存的百分比，占用越高，进程越耗费资源
VSZ : 该进程占用虚拟内存的大小，单位KB
RSS : 该进程占用实际物理内存的大小，单位KB
TTY : 该进程是在哪个终端中运行的。其中tty1-tty7代表本地控制台终端，tty1-tty6是本地的字符界面终端，tty7是图形终端。pts/0-255代表虚拟终端。
STAT : 进程状态。常见的状态有：R：运行、S：睡眠、T：停止状态、s：包含子进程、+：位于后台
START : 该进程的启动时间
TIME : 该进程占用CPU的运算时间，注意不是系统时间
COMMAND : 产生此进程的命令名


pstree [选项]
选项：
-p : 显示进程的PID
-u : 显示进程的所属用户

3. 杀死进程
kill命令

kill -l : 查看可用的进程信号
kill [-信号号] pid

常用的信号：
1 SIGHUP 该信号让进程立即关闭，然后重新读取配置文件之后重启
9 SIGKILL 用来立即结束程序的运行，本信号不能被阻塞、处理和忽略。一般用于强制终止进程
15 SIGTERM 正常结束进程的信号，kill命令的默认信号。有时如果进程已经发生问题，这个信号是无法正常终止进程的，我们才会尝试SIGKILL信号，也就是信号9


killall命令
killall [ 选项] [信号] 进程名
按照进程名杀死进程
选项：
-i : 交互式，询问是否要杀死某个进程
-I : 忽略进程名的大小写


pkill [选项] [信号] 进程名
按照进程名终止进程
选项：
-t 终端号: 按照终端号踢出用户

例子：
w : 使用w命令查询本机已经登录的用户
pkill -t -9 pts/1 : 强制杀死从pts/1虚拟终端登录的进程


# 工作管理

1、 把进程放入后台
tar -zcf etc.tar.gz /etc &
top 在top命令执行的工程中，按下ctrl+z快捷键

2、 查看后台的工作
jobs [-l]
选项：
-l : 显示工作的PID
注： “+”号代表最近一个放入后台的工作，也是工作恢复时，默认恢复的工作。“-号”号代表倒数第二个放入后台的工作

3、 将后台暂停的工作恢复到前台执行
fg %工作号
参数:
%工作号 : %号可以省略，但是注意工作号和PID的区别

4、 把后台暂停的工作恢复到后台执行
bg %工作号
注：后台恢复执行的命令，是不能和前台有交互的，否则不能恢复到后台执行


## 系统资源查看
1、vmstat 命令监控系统资源
vmstat [刷新延时] [刷新次数]
2、dmesg开机时内核检测信息
dmesg
dmesg | grep CPU

3、free命令查看内存使用状态
free [-b|-k|-m|-g]
选项：
-b : 以字节为单位显示
-k : 以KB为单位显示，默认就是以KB为单位显示
-m : 以MB为单位显示
-g : 以GB为单位显示

缓存和缓冲的区别：简单来说缓存（cache）是用来加速数据从硬盘中“读取”的，而缓冲（buffer）是用来加速数据“写入”硬盘的。

4、查看CPU信息
cat /proc/cpuinfo

5、uptime命令
uptime 显示系统的启动时间和平均负载，也就是top命令的第一行。w命令也可以看到这个数据。

6、查看系统与内核相关信息
uname [选项]
选项：
-a : 查看系统所有相关信息
-r : 查看内核版本
-s : 查看内核名称


判断当前系统的位数
file /bin/ls

查询当前linux系统的发行版本
lsb_release -a

列出进程打开或使用的文件信息
lsof [选项]
选项：
-c 字符串 : 只列出以字符串开头的进程打开的文件
-u 用户名 : 只列出某个用户的进程打开的文件
-p pid : 列出某个PID进程打开的文件


# crond服务管理与访问控制
启动crond
service crond restart
chkconfig crond on

用户的crontab设置
crontab [选项]
-e : 编辑crontab定时任务
-l : 查询crontab任务
-r : 删除当前用户所有的crontab任务

crontab -e : 进入crontab编辑界面。会打开vim编辑你的工作，格式:
```
*****执行的任务
```
项目 | 含义 | 范围
-----|------|---------
第一个"\*" | 一个小时当中第几个分钟|0-59
第二个"\*" | 一天当中第几个小时| 0-23
第三个"\*" | 一月当中第几天| 1-31
第四个"\*" | 一年当中的第几个月 | 1-12
第五个"\*" | 一周当中的星期几 | 0-7 (0和7都代表星期日)

特殊符号 | 含义
---------|--------
\* | 代表任何时间。比如第一个" * " 就代表一个小时中每分钟都执行一次的意思
,  | 代表不连续的时间。比如 "0 8,12,16 * * * 命令",就代表在每天的8点0分，12点0分，16点0分都执行一次命令
-  | 代表连续的时间范围。比如"0 5 * * 1-6 命令",代表在周一到周六的凌晨5点0分执行命令
\*/n| 代表每隔多久执行一次。比如"\*/10 * * * * 命令",代表每隔10分钟就执行一遍命令

例子：
时间  |  含义
------|-----
45 22 * * * 命令 | 在22点45分执行命令
0 17 * * 1 | 每周1的17点0分执行命令
0 5 1,15 * * 命令 | 每月1号和15号的凌晨5点0分执行命令
40 4 * * 1-5 命令 | 每周一到周五的凌晨4点40分执行命令
\*/10 4 * * * 命令 | 每天的凌晨4点，每隔10分钟执行一次命令
0 0 1,15 * 1 命令 | 每月1号和15号，每周1的0点0分都会执行命令。注意：星期几和几号最好不要同事出现，因为他们定义的都是天。非常容易让管理员混乱


#日志管理简介
在CentOS 6.x中日志服务已经由rsyslogd取代了原先的syslogd服务。rsyslogd日志服务更加先进，功能更多。但是不论该服务的使用，还是日志文件的格式其实都是和syslogd服务相兼容的，所以学习起来基本和syslogd服务一致。
rsyslogd的新特点：
* 基于TCP网络协议传输日志信息
* 更安全的网络传输方式
* 有日志消息的及时分析框架
* 后台数据库
* 配置文件中可以写简单的逻辑判断
* 与syslog配置文件兼容

```
确定服务启动
$ ps aux | grep rsyslogd

查看服务是否自启动
$ chkconfig --list | grep rsyslog
```

常见日志的作用
日志文件 | 说明
---------|--------
/var/log/cron | 记录了系统定时任务相关的日志
/var/log/cups/ | 记录打印信息的日志
/var/log/dmesg | 记录了系统在开机时内核自检的信息。也可以使用dmesg命令直接查看内核自检信息
/var/log/btmp  | 记录错误登录的日志。这个文件是二进制文件，不能之际vi查看，而要使用lastb命令查看，命令如下： $lastb （root tty1 Tun jun 4 22:38-22:38 (00:00)）有人在6月4日22:38使用root用户，在本地终端1登录错误
/var/log/lastlog| 记录系统中所有用户最后一次的登录时间日志。这个文件也是二进制文件，不能直接vi，而要使用lastlog命令查看
/var/log/mailog | 记录邮件信息
/var/log/message| 记录系统重要信息日志。这个日志文件中会记录linux系统的绝大多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日志文件
/var/log/secure | 记录验证和授权方面的信息，只要涉及账户和密码的程序都会记录。比如说系统的登录，ssh的登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中
/var/log/wtmp  | 永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样这个文件也是一个二进制文件，不能直接vi，而需要使用last命令查看。
/var/run/utmp  | 记录当前已经登录的用户信息。这个文件会随着用户的登录和注销而不断变化，只记录当前登录用户的信息。同样这个文件不能直接vi，而要使用w，who，users等命令来查询。

除了系统默认的日志外，采用RPM方式安装的系统服务也会默认把日志记录在/var/log目录中（源码包安装的日志是在源码包指定目录中）。不过这些日志不是由rsyslogd服务来记录和管理的，而是各个服务使用自己的日志管理文档来记录自身日志。

# rsyslogd 日志服务

1、基本日志文件格式包含一下四列：

* 事件产生的时间
* 发生事件的服务器的主机名
* 产生事件的服务名或程序名
* 事件的具体信息

2、/etc/rsyslog.conf配置文件
服务名称[连接符号]日志等级   日志记录位置
```
authpriv.*     /var/log/secure
认证相关服务.所有日志等级  记录在/var/log/secure日志中
```

服务名称 | 说明
---------|----------
auth | 安全和认证相关消息（不推荐使用authpriv代替）
authpriv.\*     /var/log/secure
authpriv.\*     /var/log/secure
authpriv | 安全和认证相关消息（私有的）
cron     | 系统定时任务cron和at产生的日志
daemon   | 和各个守护进程相关的日志
ftp      | ftp守护进程产生的日志
kern     | 内核产生的日志（不是用户进程产生的）
local0-local7 | 为本地使用预留的服务
lpr      | 打印产生的日志
mail     | 邮件收发信息
news     | 与新闻服务器相关日志
syslog   | 有syslogd服务产生的日志信息（虽然服务名称已经改为rsyslogd，但是很多配置还是沿用了syslogd的，这里并没有修改服务名
user     | 用户等级类别的日志信息
uucp     | uucp子系统的日志信息，uucp是早起linux系统进行数据传递的协议，后来也常用在新闻组服务中



连接符号

* "."代表只要比后面的等级高的（包含该等级）日志都记录下来。比如：“cron.info”代表cron服务产生的日志，只要日志等级大于等于info级别。就是记录
* "="代表只记录所需要等级的日志，其他等级的都不记录。比如："\*.=emerg"代表人和日志服务产生的日志，只要等级是emerg等级就记录。这种用法极少见，了解就好
* ".!"代表不等于，也就是除了该等级的日志外，其他等级的日志都记录


日志等级| 说明
--------|---------
“\*”   |  代表所有日志等级
debug |  一般的调试信息说明
info  |  基本的通知信息
notice|  普通信息，但是有一定的重要性
warning| 警告信息，但是还不会影响到服务或系统的运行
err   |  错误信息，一般达到err等级的信息以及可以影响到服务或系统的运行了
crit  |  临界状态信息，比err等级还要严重
alert |  警告状态信息，比crit还要严重。必须采取行动
emerg |  疼痛等级信息，系统已经无法使用了


日志记录位置：

* 日志文件的绝对路径，如"/var/log/secure"
* 系统设备文件，如"/dev/lp0"
* 转发给远程主机，如"@192.168.0.210:514"
* 用户名，如"root"
* 忽略或丢弃日志，如"~"

# 日志轮替

1、日志文件的命名规则

* 如果配置文件中拥有“dateext”参数，那么日志会用日期来作为日志文件的后缀，例如“secure-20180101”。这样的话日志文件名不会重叠，所以也就不需要日志文件改名，只需要保存指定的日志个数，删除多余的日志文件即可。

2、logrotate配置文件
/etc/logrotate.conf

参数  |  参数说明
------|-------------
daily | 日志的轮替周期是每天
weekly| 日志的轮替周期是每周
monthly|日志的轮替周期是每月
rotate 数字| 保留的日志文件的个数。0指没有备份
compress| 日志轮替时，旧的日志进行压缩
create mode owner group|建立新日志，同时指定新日志的权限与所有者和所属组。如create 0600 root utmp
mail address | 当日志轮替时，输出内容通过邮件发送到指定的邮件地址。如mail aaa@163.com
missingok | 如果日志不存在，则忽略该日志的警告信息
notifempty | 如果日志为空文件，则不进行日志轮替
minsize 大小| 日志轮替的最小值。也就是日志一定要达到这个最小值才会轮替，否则就算时间达到也不轮替
size 大小| 日志只有大于指定大小才进行日志轮替，而不是按照时间轮替。如 size 100k
dateext | 使用日期作为日志轮替文件的后缀。如secure-20180101

3、logrotate命令
logrotate [选项] 配置文件名
选项：
如果此命令没有选项，则会按照配置文件中的条件进行日志轮替
-v: 显示日志轮替过程。加了-v选项，会显示日志的轮替的过程
-f: 强制进行日志轮替。不管日志轮替的条件是否已经符合，强制配置文件中所有的日志进行轮替



#启动管理
## CentOS 6.x 启动管理
系统运行级别

运行级别 | 含义
---------|----------
0        | 关机
1        | 单用户模式，可以想象为windows的安全模式，主要用于系统修复
2        | 不完全命令行模式，不含NFS服务
3        | 完全的命令行模式，就是标准字符界面
4        | 系统保留
5        | 图形模式
6        | 重启动

查看运行级别命令
```
runlevel
```
改变运行级别命令
```
init 运行级别
```

##CentOS 6.x启动过程
1. 开机
2. BIOS
3. 加载MBR
4. 加载MBR中的引导程序
  1. 如果单系统，直接启动 
  2. 如果多系统，调用其他分区启动扇区中的启动引导程序启动不同的操作系统
5. 加载内核
6. 内核解压并自检
7. 找到initramfs
8. 建立伪真根目录
9. 加载驱动
10. 挂载真正系统根目录
11. 调用/sbin/init
12. 调用/etc/init/rcS.conf
  1. 调用/etc/rc.d/rc.sysinit 进行系统初始化
  2. 调用/etc/inittab
13. 传入运行级别/etc/init/rc.conf
15. 调用/etc/rc.d/rc
16. 按照运行级别调用/etc/rc[0-6].d
17. 按照优先级启动和关闭相应脚本
18. 启动和关闭/etc/rc.d/rc.local中的程序
19. 登录界面
20. 输入用户名密码进入系统

initramfs内存文件系统
CentOS6.x中使用initramsf内存文件系统取代了CentOS5.x中的initrd RAM Disk。他们的作用类似，可以通过启动引导程序加载到内存中，然后加载启动过程中所需要的内核模块，比如USB、SATA、SCSI硬盘的驱动和LVM、RAID文件系统的驱动



调用/etc/init/rcS.conf配置文件主要功能是两个

1. 先调用/etc/rc.d/rc.sysinit,然后由/etc/rc.d/rc.sysinit配置文件进行Linux系统初始化
2. 然后再调用/etc/inittab,然后由/etc/inittab配置系统文件确定系统的默认运行级别。


由/etc/rc.d/rc.sysinit初始化

1. 获得网络环境
2. 挂载设备
3. 开机启动画面Plymouth（取替了过往的RHGB）
4. 判断是否启用SELinux
5. 显示开机过程中的欢迎画面
6. 初始化硬件
7. 用户自定义模块的加载
8. 配置内核的参数
9. 设置主机名
10. 同步存储器
11. 设备映射器及相关的初始化
12. 初始化软件磁盘阵列（RAID）
13. 初始化LVM的文件系统功能
14. 检验磁盘文件系统（fsck）
15. 设置磁盘配额（quota）
16. 重新以可读写模式挂载系统磁盘
17. 更新quota（非必要）
18. 启动系统虚拟随机数生成器
19. 配置机器（非必要）
20. 清除开机过程当中的临时文件
21. 创建ICE目录
22. 启动交换分区（swap）
23. 将开机信息写入/var/log/dmesg文件中


调用/etc/rc.d/rc文件
运行级别参数传入/etc/rc.d/rc这个脚本之后，由这个脚本文件按照不同的运行级别启动/etc/rc[0-6].d/目录中的相应的程序
1. /etc/rc3.d/k?? 开头的文件（？？是数字），会按照数字顺序依次关闭，关机时依次把指定的程序关闭
2. /etc/rc3.d/S?? 开头的文件（？？是数字），会按照数字顺序依次关闭，开机时依次把指定的程序启动



## 启动引导程序grub
### grub配置文件

grub中分区表示
硬盘    |  分区  |  linux中设备文件名 |  grub中设备文件名
--------|--------|--------------------|-------------------
第一块SCSI硬盘| 第一个主分区| /dev/sda1 | hd(0,0)
~      | 第二个主分区| /dev/sda2 | hd(0,1)
~      | 扩展主分区  | /dev/sda3 | hd(0,2)
~      | 第一个逻辑分区|/dev/sda5| hd(0,4)
第二块SCSI硬盘| 第一个主分区| /dev/sdb1 | hd(1,0)
~      | 第二个主分区| /dev/sdb2 | hd(1,1)
~      | 扩展主分区  | /dev/sdb3 | hd(1,2)
~      | 第一个逻辑分区|/dev/sdb5| hd(1,4)


/boot/grub/grub.conf

1. default=0 默认启动第一个系统
2. timeout=5 等待时间，默认是5秒
3. splashimage=(hd0,0)/grub/splash.xpm.gz 这里是指定grub启动时的背景图像文件的保存位置的
4. hiddenmenu 隐藏菜单
5. title
  1. root(hd0,0) 是指启动程序的保存分区
  2. kernel ...  定义内核加载时的选项
  3. initrd /initramfs-2.6.32-279.el6.i686.img 指定了initramfs内存文件系统景象文件的所在位置




### grub加密
1. grub 加密

```
生成加密字串
$ grub-md5-crypt

vi /boot/grub/grub.conf
添加：
password --md5 xxxxxxxxxxx
```


## 系统修复模式

单用户模式常见的错误修复

* 遗忘root密码
* 修改系统默认运行级别

光盘修复模式

* 通过光盘启动，修改硬盘中的grub密码

# 备份与恢复

##备份
linux系统需要备份的数据

* /root/目录
* /home/目录
* /var/spool/mail/目录
* /etc/目录
* 其他目录

备份策略
* 完全备份：完全备份就是指把所有需要备份的数据全部备份，当然完全备份可以备份整块硬盘，整个分区或整个具体的目录
* 增量备份
* 差异备份

## dump
dump [选项] 备份之后的文件名 原文件或目录
选项 | 说明
------|----------
-level| 就是我们说的0-9十个备份级别(使用时直接写 -0，并不是 -level 0)
-f 文件名| 指定备份之后的文件名
-u    | 指定备份成功之后，把备份时间记录在/etc/dumpdates文件
-v    | 显示备份过程中更多的输出信息
-j    | 调用bzlib库压缩备份文件，其实就是把备份文件压缩为.bz2格式
-W    | 显示允许被dump的分区的备份等级及备份时间

备份分区
```
$ dump -0uj -f /root/boot.bak.bz2 /boot/
备份命令。先执行一次完全备份，并压缩和更新备份时间

$ cat /etc/dumpdates
查看备份时间文件

$ dump -1uj -f /root/boot.bak1.bz2 /boot/
增量备份boot分区，并压缩

dump -W
查询分区的备份时间及备份级别

备份文件或目录

dump -0j -f /root/etc.dump.bz2 /etc/
完全备份/etc/目录，只能使用0级别进行完全备份，而不再支持增量备份
```


##restore 命令
restore [模式选项] [选项]
模式选项有以下四种，这四个模式不能混用。

* -C : 比较备份数据和实际数据的变化
* -i : 进入交互模式，手工选择需要恢复的文件
* -t : 查看模式，用于查看备份文件中拥有哪些数据
* -r : 还原模式，用于数据还原(会把数据解压到当前目录中)
选项：
* -f : 指定备份文件的文件名




